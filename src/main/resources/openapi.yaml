openapi: 3.0.3
info:
  title: WhatToEat API
  description: |
    Recipe management API with account creation, authentication, and recipe search functionality.
    Users can create accounts, search for recipes using LLM integration, and save favorite recipes.

    This API follows the Zalando RESTful API Guidelines (https://opensource.zalando.com/restful-api-guidelines/).
  version: 1.0.0
  contact:
    name: WhatToEat API Support

servers:
  - url: http://localhost:8080
    description: Development server

tags:
  - name: Authentication
    description: Account management and authentication endpoints
  - name: User
    description: User profile and settings endpoints
  - name: Health
    description: System health and status endpoints

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns the health status of the API
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /auth/register:
    post:
      tags:
        - Authentication
      summary: Create new account
      description: |
        Register a new user account with email and password.
        Password must meet security requirements:
        - Minimum 8 characters
        - At least one uppercase letter
        - At least one lowercase letter
        - At least one digit
        - At least one special character
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              validRequest:
                summary: Valid registration request
                value:
                  email: user@example.com
                  password: SecurePass123!
      responses:
        '201':
          description: Account created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserData'
              examples:
                success:
                  summary: Successful registration
                  value:
                    user_id: 1
                    email: user@example.com
                    created_at: "2025-11-22T20:15:00Z"
        '400':
          description: Invalid input data
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
              examples:
                invalidEmail:
                  summary: Invalid email format
                  value:
                    type: "https://whattoeat.example.com/problems/validation-error"
                    title: "Validation Error"
                    status: 400
                    detail: "Invalid email format"
                weakPassword:
                  summary: Weak password
                  value:
                    type: "https://whattoeat.example.com/problems/validation-error"
                    title: "Validation Error"
                    status: 400
                    detail: "Password must contain at least one uppercase letter"
        '409':
          description: Email already registered
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
              examples:
                emailExists:
                  summary: Email already exists
                  value:
                    type: "https://whattoeat.example.com/problems/conflict"
                    title: "Resource Conflict"
                    status: 409
                    detail: "Email already registered"
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'

  /auth/login:
    post:
      tags:
        - Authentication
      summary: Login to account
      description: |
        Authenticate with email and password to receive JWT access and refresh tokens.
        The access token should be used for authenticated requests.
        The refresh token can be used to obtain a new access token when it expires.
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              validRequest:
                summary: Valid login request
                value:
                  email: user@example.com
                  password: SecurePass123!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthData'
              examples:
                success:
                  summary: Successful login
                  value:
                    user_id: 1
                    email: user@example.com
                    access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    expires_in: 3600
        '400':
          description: Invalid input data
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '401':
          description: Invalid credentials
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
              examples:
                invalidCredentials:
                  summary: Invalid email or password
                  value:
                    type: "https://whattoeat.example.com/problems/authentication-failed"
                    title: "Authentication Failed"
                    status: 401
                    detail: "Invalid email or password"
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: |
        Use a valid refresh token to obtain a new access token.
        This should be called when the access token expires.
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
            examples:
              validRequest:
                summary: Valid refresh token request
                value:
                  refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenData'
              examples:
                success:
                  summary: Successful token refresh
                  value:
                    access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    expires_in: 3600
        '400':
          description: Invalid input data
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '401':
          description: Invalid or expired refresh token
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
              examples:
                invalidToken:
                  summary: Invalid refresh token
                  value:
                    type: "https://whattoeat.example.com/problems/authentication-failed"
                    title: "Authentication Failed"
                    status: 401
                    detail: "Invalid or expired refresh token"
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'

  /user/profile:
    get:
      tags:
        - User
      summary: Get user profile
      description: Get the profile information for the authenticated user
      operationId: getUserProfile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
              examples:
                success:
                  summary: Successful profile retrieval
                  value:
                    user_id: 1
                    email: user@example.com
                    created_at: "2025-11-22T20:15:00Z"
                    updated_at: "2025-11-22T20:15:00Z"
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
              examples:
                missingToken:
                  summary: Missing authentication token
                  value:
                    type: "https://whattoeat.example.com/problems/authentication-required"
                    title: "Authentication Required"
                    status: 401
                    detail: "Missing or invalid authentication token"
                invalidToken:
                  summary: Invalid token
                  value:
                    type: "https://whattoeat.example.com/problems/authentication-failed"
                    title: "Authentication Failed"
                    status: 401
                    detail: "Invalid or expired token"
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from login or refresh endpoints

  schemas:
    RegisterRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          maxLength: 255
          description: User's email address
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          description: |
            User's password. Must contain:
            - At least 8 characters
            - One uppercase letter
            - One lowercase letter
            - One digit
            - One special character
          example: SecurePass123!

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        password:
          type: string
          format: password
          description: User's password
          example: SecurePass123!

    RefreshTokenRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          description: Valid refresh token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

    Problem:
      type: object
      required:
        - type
        - title
        - status
      properties:
        type:
          type: string
          description: |
            A URI reference (string) that identifies the problem type.
            When dereferenced, it should provide human-readable documentation.
          example: "https://whattoeat.example.com/problems/validation-error"
        title:
          type: string
          description: A short, human-readable summary of the problem type
          example: "Validation Error"
        status:
          type: integer
          format: int32
          description: The HTTP status code
          example: 400
        detail:
          type: string
          description: A human-readable explanation specific to this occurrence of the problem
          example: "The email field must be a valid email address"
        instance:
          type: string
          description: A URI reference (string) that identifies the specific occurrence of the problem
          example: "/auth/register"

    UserData:
      type: object
      properties:
        user_id:
          type: integer
          description: Unique user identifier
          example: 1
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp in RFC 3339 format
          example: "2025-11-22T20:15:00Z"

    AuthData:
      type: object
      properties:
        user_id:
          type: integer
          example: 1
        email:
          type: string
          format: email
          example: user@example.com
        access_token:
          type: string
          description: JWT access token for authenticated requests
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refresh_token:
          type: string
          description: JWT refresh token for obtaining new access tokens
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        expires_in:
          type: integer
          description: Access token expiration time in seconds
          example: 3600

    TokenData:
      type: object
      properties:
        access_token:
          type: string
          description: New JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refresh_token:
          type: string
          description: New JWT refresh token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        expires_in:
          type: integer
          description: Access token expiration time in seconds
          example: 3600

    UserProfile:
      type: object
      properties:
        user_id:
          type: integer
          example: 1
        email:
          type: string
          format: email
          example: user@example.com
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp in RFC 3339 format
          example: "2025-11-22T20:15:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last profile update timestamp in RFC 3339 format
          example: "2025-11-22T20:15:00Z"