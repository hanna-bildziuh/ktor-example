# WhatToEat - Recipe Management API

## Overview
WhatToEat is a Kotlin-based REST API application for recipe management. Users can create accounts, search for recipes using LLM integration, and save their favorite recipes. Built with Ktor framework for web server functionality and Exposed ORM for database operations.

## Tech Stack
- **Language:** Kotlin 2.2.20
- **Web Framework:** Ktor 3.0.3
- **ORM:** Exposed 0.58.0
- **Database:** H2 (development)
- **Build Tool:** Maven
- **Logging:** Logback 1.5.12

## Project Structure
```
ktor-example/
├── documentation/
│   └── create-account-flow.md     # Implementation plan for user registration
├── src/
│   ├── main/
│   │   ├── kotlin/
│   │   │   ├── routes/
│   │   │   │   └── GenericRoute.kt    # Generic routes (/, /health, swagger)
│   │   │   └── WhatToEat.kt           # Main application entry point
│   │   └── resources/
│   │       └── openapi.yaml           # OpenAPI 3.0 specification
│   └── test/
│       └── kotlin/
├── pom.xml
└── .claude.md
```

## Application Features
- **User Authentication**: Account creation, login with JWT authentication
- **Recipe Search**: LLM-powered recipe search functionality
- **Favorites Management**: Save and manage favorite recipes in database
- **REST API**: RESTful endpoints for all operations

## Key Dependencies

### Kotlin
- `kotlin-stdlib` - Kotlin standard library
- `kotlinx-coroutines-core` (1.10.1) - Coroutines support for async operations

### Ktor
- `ktor-server-core-jvm` - Core server functionality
- `ktor-server-netty-jvm` - Netty engine for running the server
- `ktor-server-content-negotiation-jvm` - Content negotiation support
- `ktor-serialization-kotlinx-json-jvm` - JSON serialization
- `ktor-server-swagger-jvm` - Swagger UI integration
- `ktor-server-openapi` - OpenAPI specification support
- `ktor-server-cors-jvm` - CORS support

### Exposed
- `exposed-core` - Core ORM functionality
- `exposed-dao` - DAO pattern support
- `exposed-jdbc` - JDBC database connectivity
- `exposed-java-time` - Java Time API support (LocalDateTime, etc.)

### Database
- H2 Database - In-memory/file-based database for development

### Logging
- Logback Classic - Logging framework

## API-First Approach

This project follows an API-first design approach using OpenAPI 3.0 specification.
Uses https://opensource.zalando.com/restful-api-guidelines/ for the guidelines

### OpenAPI Specification
- **Location:** `src/main/resources/openapi.yaml`
- **Version:** OpenAPI 3.0.3
- **Format:** YAML

The OpenAPI specification defines all API endpoints, request/response schemas, security schemes, and validation rules before implementation.

### API Documentation
Interactive API documentation is available via Swagger UI:

**Swagger UI:** `http://localhost:8080/swagger`

The Swagger UI provides:
- Interactive API explorer
- Request/response examples
- Schema definitions
- Authentication testing
- Try-it-out functionality

### Current API Endpoints

#### Authentication
- `POST /auth/register` - Create new user account
- `POST /auth/login` - Login and receive JWT tokens
- `POST /auth/refresh` - Refresh access token

#### User
- `GET /user/profile` - Get user profile (JWT protected)

#### System
- `GET /` - Welcome message
- `GET /health` - Health check

### Security
- JWT Bearer authentication for protected endpoints
- BCrypt password hashing (planned)
- CORS enabled for development (configure for production)

## Development

### Build Commands
```bash
# Clean and build
mvn clean install

# Run application
mvn exec:java

# Run tests
mvn test
```

### Main Class
The main entry point is `WhatToEat.kt`, which:
- Starts the Ktor server on port 8080
- Configures JSON serialization with kotlinx.serialization
- Initializes H2 in-memory database connection
- Sets up routing with basic health check endpoints

Main class configured as `WhatToEatKt` in the exec-maven-plugin.

##  Architecture
### Routes
- located in the `routes` package
### Database
- Models  are located in the `repostories.database` package
- Tables and Models are located in the `repostories.database` package
- Models should be located in the same file as corresponding table
- Services that are repositories are interfaces and called {Entity}Repository. They are located in the `repostories` package
- Implementations of the repositories should be called {Entity}RepositoryImplementation and located in the `repostories.services` package

## Code Style
- Kotlin official code style
- JVM Target: 1.8
- Do not use wildcards in the imports

## Coroutines Support
Full coroutines support is available for:
- Async database operations with Exposed (`newSuspendedTransaction`, `dbQuery`)
- Suspend functions in Ktor route handlers
- Creating custom coroutine scopes for background tasks
- Concurrent operations with `launch`, `async`, `await`
- Flow-based reactive programming

## Testing
- JUnit 5 for testing
- Ktor test host for server testing
- Kotlin test utilities

## Notes
- Project uses Maven for dependency management
- Source directory: `src/main/kotlin`
- Test directory: `src/test/kotlin`
